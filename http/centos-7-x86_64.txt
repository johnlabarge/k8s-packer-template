install
text
cdrom
lang en_US.UTF-8
keyboard us
network --onboot yes --bootproto dhcp --noipv6
authconfig --enableshadow --passalgo=sha512
timezone --utc UTC
zerombr
clearpart --all --initlabel
bootloader --location=mbr 
part / --size=100 --grow --fsoptions="defaults" --label=/ --fstype=ext4

# Repositories to use
repo --name="CentOS" --baseurl=http://mirror.centos.org/centos/7/os/x86_64/ --cost=100
## Uncomment for rolling builds
#repo --name="Updates" --baseurl=http://mirror.centos.org/centos/7/updates/x86_64/ --cost=100
repo
rootpw changeme

firewall --disabled
selinux --disabled

services --disabled=NetworkManager,kdump --enabled=network,sshd

skipx

reboot

%packages --nobase
@core
openssh-server
openssh-clients
acpid
kpartx
gdisk
net-tools
ntp
parted
rsync
vim
# Make sure that subscription-manager and rhn packages are not installed as
# they conflict with GCE packages.
-subscription-manager
-*rhn*
-alsa-utils
-b43-fwcutter
-dmraid
-eject
-gpm
-kexec-tools
-irqbalance
-microcode_ctl
-smartmontools
-aic94xx-firmware
-atmel-firmware
-b43-openfwwf
-bfa-firmware
-efibootmgr
-ipw2100-firmware
-ipw2200-firmware
-ivtv-firmware
-iwl100-firmware
-iwl1000-firmware
-iwl3945-firmware
-iwl4965-firmware
-iwl5000-firmware
-iwl5150-firmware
-iwl6000-firmware
-iwl6000g2a-firmware
-iwl6050-firmware
-kernel-firmware
-libertas-usb8388-firmware
-ql2100-firmware
-ql2200-firmware
-ql23xx-firmware
-ql2400-firmware
-ql2500-firmware
-rt61pci-firmware
-rt73usb-firmware
-xorg-x11-drv-ati-firmware
-zd1211-firmware
%end

%post 
set -x

cat >>/etc/dhclient.conf <<EOL
# Set the dhclient retry interval to 10 seconds instead of 5 minutes.
retry 10;
EOL

## Set the network settings for eth0.
## Set the MTU.
## Set dhclient to be persistent instead of oneshot.
## Enable IPv6.
cat >>/etc/sysconfig/network-scripts/ifcfg-eth0 <<EOL
MTU=1460
PERSISTENT_DHCLIENT="y"
IPV6INIT=yes
EOL
## Remove files which shouldn't make it into the image.
rm -f /etc/boto.cfg /etc/udev/rules.d/70-persistent-net.rules
#
%end
